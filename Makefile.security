# üõ°Ô∏è Dohodometr Security Operations Makefile
# –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—Å–µ—Ö security –æ–ø–µ—Ä–∞—Ü–∏–π

.PHONY: help security-setup security-today security-week security-month audit monitoring secrets pen-test

# Default target
help: ## üìã –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
	@echo "üõ°Ô∏è Dohodometr Security Operations"
	@echo "================================="
	@echo
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'
	@echo
	@echo "üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:"
	@echo "  1. make security-today     # –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
	@echo "  2. make security-week      # Security –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞"
	@echo "  3. make security-month     # Enterprise —Ä–µ—à–µ–Ω–∏—è"

# ===========================================
# üö® –ö–†–ò–¢–ò–ß–ù–û - –°–ï–ì–û–î–ù–Ø
# ===========================================

security-today: generate-secrets ## üö® –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ security –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–µ–≥–æ–¥–Ω—è
	@echo "üö® –í—ã–ø–æ–ª–Ω—è–µ–º –∫—Ä–∏—Ç–∏—á–Ω—ã–µ security –æ–ø–µ—Ä–∞—Ü–∏–∏..."
	@echo "‚ö†Ô∏è  –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ production —Å–µ—Ä–≤–µ—Ä—É!"
	@echo
	@echo "üìã –ß—Ç–æ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:"
	@echo "  1. ‚úÖ –°–µ–∫—Ä–µ—Ç—ã —É–∂–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã"
	@echo "  2. üì§ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ production (—Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)"
	@echo "  3. üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤"
	@echo "  4. üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"
	@echo
	@read -p "–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å production —Å–µ—Ä–≤–µ—Ä–∞ (user@server): " SERVER; \
	if [ -n "$$SERVER" ]; then \
		echo "üì§ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –Ω–∞ $$SERVER..."; \
		./deployment/deploy_production_secrets.sh "$$SERVER" || echo "‚ùå –û—à–∏–±–∫–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤"; \
		echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ $$SERVER..."; \
		./deployment/restart_services.sh "$$SERVER" || echo "‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤"; \
		echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ $$SERVER..."; \
		./deployment/test_auth.sh "$$SERVER" || echo "‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"; \
		echo "‚úÖ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!"; \
	else \
		echo "‚ùå –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ —É–∫–∞–∑–∞–Ω. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é:"; \
		echo "  ./deployment/deploy_production_secrets.sh user@your-server"; \
		echo "  ./deployment/restart_services.sh user@your-server"; \
		echo "  ./deployment/test_auth.sh user@your-server"; \
	fi

generate-secrets: ## üîê –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å production —Å–µ–∫—Ä–µ—Ç—ã
	@echo "üîê –ì–µ–Ω–µ—Ä–∏—Ä—É—é production —Å–µ–∫—Ä–µ—Ç—ã..."
	@if [ ! -f .env.production ]; then \
		./deployment/generate_secure_secrets.sh .env.production; \
		echo "‚úÖ –°–µ–∫—Ä–µ—Ç—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã: .env.production"; \
		echo "üîí –ü—Ä–∞–≤–∞ —Ñ–∞–π–ª–∞: $$(stat -c '%a' .env.production)"; \
	else \
		echo "‚ö†Ô∏è  –§–∞–π–ª .env.production —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"; \
		echo "üîí –î–ª—è –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª: rm .env.production"; \
	fi

deploy-secrets: ## üì§ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –Ω–∞ production (—Ç—Ä–µ–±—É–µ—Ç SERVER=user@host)
	@if [ -z "$(SERVER)" ]; then \
		echo "‚ùå –£–∫–∞–∂–∏—Ç–µ SERVER: make deploy-secrets SERVER=user@your-server"; \
	else \
		echo "üì§ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –Ω–∞ $(SERVER)..."; \
		./deployment/deploy_production_secrets.sh $(SERVER); \
	fi

restart-services: ## üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã (—Ç—Ä–µ–±—É–µ—Ç SERVER=user@host)
	@if [ -z "$(SERVER)" ]; then \
		echo "‚ùå –£–∫–∞–∂–∏—Ç–µ SERVER: make restart-services SERVER=user@your-server"; \
	else \
		echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ $(SERVER)..."; \
		./deployment/restart_services.sh $(SERVER); \
	fi

test-auth: ## üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
	@echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏..."
	@read -p "–í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è [http://localhost:8000]: " URL; \
	URL=$${URL:-http://localhost:8000}; \
	./deployment/test_auth.sh "$$URL"

# ===========================================
# üìÖ –ù–ê –≠–¢–û–ô –ù–ï–î–ï–õ–ï  
# ===========================================

security-week: pen-test setup-monitoring training-materials ## üìÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å security –∑–∞–¥–∞—á–∏ –Ω–∞ –Ω–µ–¥–µ–ª—é
	@echo "‚úÖ Security –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!"
	@echo
	@echo "üìã –ß—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:"
	@echo "  ‚úÖ Penetration testing –∑–∞–ø—É—â–µ–Ω"
	@echo "  ‚úÖ Monitoring —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞"  
	@echo "  ‚úÖ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã"
	@echo
	@echo "üìä –î–æ—Å—Ç—É–ø –∫ –¥–∞—à–±–æ—Ä–¥–∞–º:"
	@echo "  ‚Ä¢ Grafana: http://localhost:3001 (admin/admin123)"
	@echo "  ‚Ä¢ Prometheus: http://localhost:9090"
	@echo "  ‚Ä¢ Kibana: http://localhost:5601"

pen-test: ## üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å penetration testing
	@echo "üîç –ó–∞–ø—É—Å–∫ penetration testing..."
	@read -p "–í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è [http://localhost:8000]: " URL; \
	URL=$${URL:-http://localhost:8000}; \
	./security/penetration_testing.sh "$$URL"; \
	echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤: security/pentest_reports/"

setup-monitoring: ## üìä –ù–∞—Å—Ç—Ä–æ–∏—Ç—å security –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
	@echo "üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ security –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞..."
	./security/setup_security_monitoring.sh
	@echo "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!"
	@echo "üöÄ –î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è: cd security/monitoring && ./deploy_monitoring.sh"

training-materials: ## üë• –ü–æ–∫–∞–∑–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
	@echo "üë• –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã security:"
	@echo "üìö –û—Å–Ω–æ–≤–Ω–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª: security/team_training_materials.md"
	@echo "‚è±Ô∏è  –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è: 2-4 —á–∞—Å–∞ (–º–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —Å–µ—Å—Å–∏–∏)"
	@echo "üéØ –ü–ª–∞–Ω:"
	@echo "  ‚Ä¢ –î–µ–Ω—å 1: Security Mindset + Secure Coding (1.5—á)"
	@echo "  ‚Ä¢ –î–µ–Ω—å 2: Authentication & Data Protection (1—á)"  
	@echo "  ‚Ä¢ –î–µ–Ω—å 3: DevSecOps + Incident Response (1.5—á)"

# ===========================================
# üóìÔ∏è –í –¢–ï–ß–ï–ù–ò–ï –ú–ï–°–Ø–¶–ê
# ===========================================

security-month: setup-secrets-management setup-rotation internal-audit ## üóìÔ∏è –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ security –∑–∞–¥–∞—á–∏
	@echo "‚úÖ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ security –∑–∞–¥–∞—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã!"
	@echo
	@echo "üìã –ß—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:"
	@echo "  ‚úÖ Enterprise secrets management –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
	@echo "  ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤"
	@echo "  ‚úÖ –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π security audit"

setup-secrets-management: ## üèõÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å enterprise secrets management
	@echo "üèõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ enterprise secrets management..."
	./security/secrets_management_setup.sh
	@echo "‚úÖ Secrets management –Ω–∞—Å—Ç—Ä–æ–µ–Ω!"
	@echo "üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: security/secrets_management/DEPLOYMENT_GUIDE.md"
	@echo "üéØ –í—ã–±–µ—Ä–∏—Ç–µ:"
	@echo "  ‚Ä¢ AWS Secrets Manager (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è): cd security/secrets_management/aws/terraform && terraform apply"
	@echo "  ‚Ä¢ HashiCorp Vault: cd security/secrets_management/vault && ./scripts/init_vault.sh"

setup-rotation: ## üîÑ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–æ—Ç–∞—Ü–∏—é —Å–µ–∫—Ä–µ—Ç–æ–≤  
	@echo "üîÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–æ—Ç–∞—Ü–∏–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤..."
	@echo "üìã –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç: security/secrets_management/secret_rotation.py"
	@echo "‚è∞ –î–æ–±–∞–≤—å—Ç–µ –≤ cron:"
	@echo "   0 2 * * 0 python3 /opt/dohodometr/security/secrets_management/secret_rotation.py"

internal-audit: ## üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π security audit
	@echo "üîç –ó–∞–ø—É—Å–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ security audit..."
	@read -p "–í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è –∞—É–¥–∏—Ç–∞ [http://localhost:8000]: " URL; \
	URL=$${URL:-http://localhost:8000}; \
	cd security/internal_audit && ./run_full_audit.sh "$$URL"; \
	echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤: security/internal_audit/reports/"

# ===========================================
# üîß –£–¢–ò–õ–ò–¢–´ –ò –ü–†–û–í–ï–†–ö–ò
# ===========================================

check-security: ## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
	@echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏..."
	@echo
	@echo "üìÅ –§–∞–π–ª—ã —Å–µ–∫—Ä–µ—Ç–æ–≤:"
	@ls -la .env.production 2>/dev/null && echo "  ‚úÖ .env.production —Å—É—â–µ—Å—Ç–≤—É–µ—Ç" || echo "  ‚ùå .env.production –Ω–µ –Ω–∞–π–¥–µ–Ω"
	@echo
	@echo "üîß –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:"
	@ls -la deployment/*.sh security/*.sh 2>/dev/null | grep -E "^-rwx" | wc -l | xargs echo "  ‚úÖ –ò—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤:"
	@echo
	@echo "üê≥ Docker —Å—Ç–∞—Ç—É—Å:"
	@docker ps --format "table {{.Names}}\t{{.Status}}" 2>/dev/null | head -5 || echo "  ‚ùå Docker –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
	@echo
	@echo "üìä –°–æ–∑–¥–∞–Ω–Ω—ã–µ security —Ñ–∞–π–ª—ã:"
	@find security/ -name "*.sh" -o -name "*.py" -o -name "*.md" 2>/dev/null | wc -l | xargs echo "  üìÑ Security —Ñ–∞–π–ª–æ–≤:"

clean-reports: ## üßπ –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ—Ç—á–µ—Ç—ã
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ—Ç—á–µ—Ç–æ–≤..."
	@rm -rf security/pentest_reports/* || true
	@rm -rf security/internal_audit/reports/* || true
	@rm -rf security/monitoring/reports/* || true
	@echo "‚úÖ –û—Ç—á–µ—Ç—ã –æ—á–∏—â–µ–Ω—ã"

validate-env: ## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ environment —Ñ–∞–π–ª–æ–≤
	@echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ environment —Ñ–∞–π–ª–æ–≤..."
	@if [ -f .env.production ]; then \
		echo "üîç –ê–Ω–∞–ª–∏–∑ .env.production:"; \
		echo "  üìè –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: $$(wc -c < .env.production) –±–∞–π—Ç"; \
		echo "  üîê –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—Ä–µ—Ç–æ–≤: $$(grep -E '^[A-Z_]+=.{16,}' .env.production | wc -l)"; \
		echo "  ‚ö†Ô∏è  –°–ª–∞–±—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: $$(grep -E '(password|admin|secret|123)' .env.production | wc -l)"; \
	else \
		echo "‚ùå .env.production –Ω–µ –Ω–∞–π–¥–µ–Ω"; \
	fi

# ===========================================  
# üö® –≠–ö–°–¢–†–ï–ù–ù–´–ï –ü–†–û–¶–ï–î–£–†–´
# ===========================================

emergency-lockdown: ## üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (revoke –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤)
	@echo "üö® –≠–ö–°–¢–†–ï–ù–ù–ê–Ø –ë–õ–û–ö–ò–†–û–í–ö–ê –°–ò–°–¢–ï–ú–´"
	@echo "=================================="
	@read -p "‚ö†Ô∏è  –í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –æ—Ç–∑–æ–≤–µ—Ç –í–°–ï —Ç–æ–∫–µ–Ω—ã! (yes/no): " CONFIRM; \
	if [ "$$CONFIRM" = "yes" ]; then \
		echo "üö® –í—ã–ø–æ–ª–Ω—è–µ–º —ç–∫—Å—Ç—Ä–µ–Ω–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É..."; \
		docker exec -it dohodometr-redis redis-cli FLUSHDB || echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å Redis"; \
		echo "‚úÖ –í—Å–µ —Ç–æ–∫–µ–Ω—ã –æ—Ç–æ–∑–≤–∞–Ω—ã"; \
		echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"; \
		echo "  1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞"; \
		echo "  2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–Ω–æ–≤–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É"; \
		echo "  3. –°–º–µ–Ω–∏—Ç–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã"; \
	else \
		echo "‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞"; \
	fi

backup-secrets: ## üíæ –°–æ–∑–¥–∞—Ç—å backup —Ç–µ–∫—É—â–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
	@echo "üíæ –°–æ–∑–¥–∞–Ω–∏–µ backup —Å–µ–∫—Ä–µ—Ç–æ–≤..."
	@BACKUP_DIR="backups/secrets_$$(date +%Y%m%d_%H%M%S)"; \
	mkdir -p "$$BACKUP_DIR"; \
	cp .env.production "$$BACKUP_DIR/" 2>/dev/null || echo "‚ö†Ô∏è  .env.production –Ω–µ –Ω–∞–π–¥–µ–Ω"; \
	tar -czf "$$BACKUP_DIR.tar.gz" "$$BACKUP_DIR" && rm -rf "$$BACKUP_DIR"; \
	echo "‚úÖ Backup —Å–æ–∑–¥–∞–Ω: $$BACKUP_DIR.tar.gz"

# ===========================================
# üìä –û–¢–ß–ï–¢–´ –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê  
# ===========================================

security-status: ## üìä –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π security —Å—Ç–∞—Ç—É—Å
	@echo "üìä DOHODOMETR SECURITY STATUS"
	@echo "============================="
	@echo
	@$(MAKE) -s check-security
	@echo
	@echo "üéØ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò:"
	@[ -f .env.production ] && echo "  ‚úÖ Production —Å–µ–∫—Ä–µ—Ç—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã" || echo "  ‚ùå Production —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã"
	@[ -d security/pentest_reports ] && echo "  ‚úÖ Penetration testing –Ω–∞—Å—Ç—Ä–æ–µ–Ω" || echo "  ‚ùå Penetration testing –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
	@[ -d security/monitoring ] && echo "  ‚úÖ Security –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω" || echo "  ‚ùå Security –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
	@[ -f security/team_training_materials.md ] && echo "  ‚úÖ Training –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≥–æ—Ç–æ–≤—ã" || echo "  ‚ùå Training –º–∞—Ç–µ—Ä–∏–∞–ª—ã –Ω–µ –≥–æ—Ç–æ–≤—ã"
	@[ -d security/secrets_management ] && echo "  ‚úÖ Secrets management –Ω–∞—Å—Ç—Ä–æ–µ–Ω" || echo "  ‚ùå Secrets management –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
	@[ -d security/internal_audit ] && echo "  ‚úÖ Internal audit –≥–æ—Ç–æ–≤" || echo "  ‚ùå Internal audit –Ω–µ –≥–æ—Ç–æ–≤"

logs: ## üìÑ –ü–æ–∫–∞–∑–∞—Ç—å security –ª–æ–≥–∏
	@echo "üìÑ Security –ª–æ–≥–∏..."
	@docker-compose logs --tail=50 backend | grep -i security || echo "–ù–µ—Ç security –ª–æ–≥–æ–≤ –≤ backend"
	@docker-compose logs --tail=50 redis | grep -i auth || echo "–ù–µ—Ç auth –ª–æ–≥–æ–≤ –≤ Redis"

# ===========================================
# üéì –ò–ù–§–û–†–ú–ê–¶–ò–Ø –ò –ü–û–ú–û–©–¨
# ===========================================

info: ## ‚ÑπÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ security setup
	@echo "‚ÑπÔ∏è DOHODOMETR SECURITY INFORMATION"
	@echo "=================================="
	@echo
	@echo "üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ security —Ñ–∞–π–ª–æ–≤:"
	@find security/ -type f -name "*.sh" -o -name "*.py" -o -name "*.md" | sort
	@echo
	@echo "üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  make security-today   # –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏"
	@echo "  make security-week    # –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏"
	@echo "  make security-month   # –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –∑–∞–¥–∞—á–∏"
	@echo
	@echo "üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:"
	@echo "  SECURITY_IMPLEMENTATION_GUIDE.md - –ü–æ–ª–Ω—ã–π –ø–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è"
	@echo "  security/team_training_materials.md - –û–±—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã"
	@echo
	@echo "üÜò –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  make emergency-lockdown  # –û—Ç–æ–∑–≤–∞—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã"
	@echo "  make backup-secrets      # Backup —Å–µ–∫—Ä–µ—Ç–æ–≤"

# ===========================================
# üîß DEVELOPMENT UTILITIES
# ===========================================

dev-test: ## üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –≤ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏
	@echo "üß™ –ó–∞–ø—É—Å–∫ dev —Ç–µ—Å—Ç–æ–≤..."
	./deployment/test_auth.sh http://localhost:8000

dev-monitoring: ## üìä –ó–∞–ø—É—Å—Ç–∏—Ç—å monitoring –¥–ª—è dev
	@echo "üìä –ó–∞–ø—É—Å–∫ dev –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞..."
	@cd security/monitoring && docker-compose -f docker-compose.monitoring.yml up -d
	@echo "‚úÖ Dev –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω:"
	@echo "  ‚Ä¢ Grafana: http://localhost:3001"
	@echo "  ‚Ä¢ Prometheus: http://localhost:9090"

dev-clean: ## üßπ –û—á–∏—Å—Ç–∏—Ç—å dev –æ–∫—Ä—É–∂–µ–Ω–∏–µ
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ dev –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
	@cd security/monitoring && docker-compose -f docker-compose.monitoring.yml down -v || true
	@docker system prune -f || true
	@echo "‚úÖ Dev –æ–∫—Ä—É–∂–µ–Ω–∏–µ –æ—á–∏—â–µ–Ω–æ"
